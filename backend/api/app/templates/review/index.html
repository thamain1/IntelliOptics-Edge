<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IntelliOptics Human Review</title>
    <link rel="stylesheet" href="/static/review.css" />
  </head>
  <body>
    <header class="top-bar">
      <h1>Detector Review Queue</h1>
      <div class="status-chip" id="queue-meta">Loading queue…</div>
    </header>

    <main>
      <section class="panel" id="filters-panel">
        <h2>Filters</h2>
        <form id="filters-form">
          <label>
            Detector ID
            <input type="text" id="detector-filter" name="detector" placeholder="All" />
          </label>
          <label class="checkbox">
            <input type="checkbox" id="pending-filter" name="pending" checked />
            Pending only
          </label>
          <label>
            Page size
            <select id="limit-select" name="limit">
              <option value="25">25</option>
              <option value="50" selected>50</option>
              <option value="100">100</option>
            </select>
          </label>
          <div class="actions">
            <button type="submit">Apply</button>
            <button type="button" id="refresh-btn">Refresh</button>
          </div>
        </form>
      </section>

      <section class="panel" id="queue-panel">
        <h2>Review Queue</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Detector</th>
                <th>Model Label</th>
                <th>Confidence</th>
                <th>Received</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="queue-body">
              <tr><td colspan="6" class="empty">Loading…</td></tr>
            </tbody>
          </table>
        </div>
        <div class="pagination">
          <button type="button" id="prev-page">Previous</button>
          <button type="button" id="next-page">Next</button>
        </div>
      </section>

      <section class="panel" id="detail-panel">
        <h2>Review Detail</h2>
        <div id="detail-empty">Select an item to view details.</div>
        <div id="detail-content" class="hidden">
          <div class="detail-grid">
            <div class="image-wrapper">
              <img id="detail-image" alt="Review item" />
            </div>
            <div class="metadata">
              <dl>
                <div><dt>ID</dt><dd id="detail-id"></dd></div>
                <div><dt>Detector</dt><dd id="detail-detector"></dd></div>
                <div><dt>Model Label</dt><dd id="detail-model-label"></dd></div>
                <div><dt>Model Confidence</dt><dd id="detail-model-confidence"></dd></div>
                <div><dt>Result Type</dt><dd id="detail-result-type"></dd></div>
                <div><dt>Status</dt><dd id="detail-status"></dd></div>
                <div><dt>Count</dt><dd id="detail-count"></dd></div>
                <div><dt>Submitted</dt><dd id="detail-received"></dd></div>
                <div><dt>Updated</dt><dd id="detail-updated"></dd></div>
              </dl>
              <div class="human-meta">
                <h3>Human Feedback</h3>
                <dl>
                  <div><dt>Label</dt><dd id="detail-human-label"></dd></div>
                  <div><dt>Confidence</dt><dd id="detail-human-confidence"></dd></div>
                  <div><dt>Reviewer</dt><dd id="detail-human-user"></dd></div>
                  <div><dt>Notes</dt><dd id="detail-human-notes"></dd></div>
                  <div><dt>Labeled At</dt><dd id="detail-human-ts"></dd></div>
                </dl>
              </div>
            </div>
          </div>

          <form id="label-form">
            <fieldset>
              <legend>Submit Human Label</legend>
              <div class="label-buttons">
                <button type="button" data-label="YES" class="label-btn yes">Yes</button>
                <button type="button" data-label="NO" class="label-btn no">No</button>
                <button type="button" data-label="UNCLEAR" class="label-btn unclear">Unclear</button>
              </div>
              <input type="hidden" id="label-choice" name="label" required />
              <label>
                Reviewer
                <input type="text" id="label-user" name="user" placeholder="Optional" />
              </label>
              <label>
                Confidence (0-1)
                <input type="number" step="0.01" min="0" max="1" id="label-confidence" name="confidence" />
              </label>
              <label>
                Object count
                <input type="number" min="0" id="label-count" name="count" />
              </label>
              <label>
                Notes
                <textarea id="label-notes" name="notes" rows="3" placeholder="Optional context"></textarea>
              </label>
              <div class="actions">
                <button type="submit">Submit label</button>
                <button type="button" id="clear-form">Clear</button>
              </div>
              <div id="label-status" role="status"></div>
            </fieldset>
          </form>
        </div>
      </section>
    </main>

    <template id="row-template">
      <tr>
        <td class="mono id"></td>
        <td class="detector"></td>
        <td class="model-label"></td>
        <td class="model-confidence"></td>
        <td class="received"></td>
        <td class="status"></td>
      </tr>
    </template>

    <script>
      window.REVIEW_CONFIG = {
        apiBase: "{{ api_base }}"
      };
    </script>
    <script src="/static/review.js" defer></script>
  </body>
</html>
