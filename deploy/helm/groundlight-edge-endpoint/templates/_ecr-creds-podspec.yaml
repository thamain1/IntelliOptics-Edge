{{- define "edge-endpoint.registry-credentials.podSpec" -}}
serviceAccountName: edge-endpoint-service-account
restartPolicy: OnFailure

containers:
  - name: refresh-acr-credentials
    image: {{ printf "%s/intellioptics/edge-endpoint:%s" .Values.azure.loginServer (include "IntelliOptics-edge-endpoint.edgeEndpointTag" .) }}
    imagePullPolicy: "{{ include "IntelliOptics-edge-endpoint.edgeEndpointPullPolicy" . }}"
    command:
      - /bin/sh
      - -c
      - /intellioptics-edge/deploy/bin/refresh-ecr-login.sh
    env:
      - name: AZURE_CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: azure-service-principal
            key: AZURE_CLIENT_ID
      - name: AZURE_CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: azure-service-principal
            key: AZURE_CLIENT_SECRET
      - name: AZURE_TENANT_ID
        valueFrom:
          secretKeyRef:
            name: azure-service-principal
            key: AZURE_TENANT_ID
      - name: AZURE_SUBSCRIPTION_ID
        valueFrom:
          secretKeyRef:
            name: azure-service-principal
            key: AZURE_SUBSCRIPTION_ID
        optional: true
      - name: AZURE_CONTAINER_REGISTRY
        value: "{{ .Values.azure.acrName }}"
      - name: ACR_LOGIN_SERVER
        value: "{{ .Values.azure.loginServer }}"
{{- end }}

